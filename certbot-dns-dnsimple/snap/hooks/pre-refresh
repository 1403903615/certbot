#!/bin/sh -e

first_install="$(snapctl get first-install)"
if [ -z "$first_install" ]; then
    snapctl set first-install="false"
    echo "first install, not doing any version comparison checks" > "$SNAP_DATA/debuglog"
    exit 0
fi

echo "ls $SNAP/certbot-shared:" > "$SNAP_DATA/debuglog"
ls $SNAP/certbot-shared > "$SNAP_DATA/debuglog"
cb_installed=$(grep -oP "__version__ = '\K.*(?=')" $SNAP/certbot-shared/__init__.py)
echo "cb_installed: $cb_installed" > "$SNAP_DATA/debuglog"
snapctl set cb-installed="$cb_installed"
