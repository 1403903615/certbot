#!/bin/sh -e

first_install=$(snapctl get first-install)
echo "$first_install"
if [ "$first_install" -ne "false"]; then
    snapctl set first-install="false"
    exit 0
fi

# get certbot version
cb_installed=$(grep -oP 'installed:\s+\K\d+.\d+.\d(?=-)' $SNAP/certbot-version/certbot)
# get required certbot version for plugin
cb_required=$(grep -oP "certbot>=\K.*(?=')" $SNAP/setup.py)

if [ "$cb_installed" -lt "$cb_required" ]; then
    echo "Certbot needs to be updated before this plugin can be updated; will try again on next refresh."
    exit 1
fi
